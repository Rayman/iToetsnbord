<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
         "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>iPhone Navigation</title>
<meta name="viewport" content="width=320; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/>
<style type="text/css" media="screen">@import "iphonenav.css";</style>
<script type="application/x-javascript" src="scripts/mootools-1.2.4-core.js"></script>
<script type="application/x-javascript" src="scripts/iphonenav.js"></script>
<script type="application/x-javascript" src="scripts/itoetsnbord.js"></script>
<script type="application/x-javascript">

function getSearchResults(element){
	var artist = $(lastSubmittedForm).getElement('input[name=artist]').value;
	var song   = $(lastSubmittedForm).getElement('input[name=song]').value;
	artist = artist == '' ? '' : 'ARTIST HAS "' + artist +'"';
	song   = song   == '' ? '' : 'TITLE HAS  "' + song   +'"';
	query = (song != '' && artist != '') ? song + ' && ' + artist : song + artist;
	var myRequest = new Request.JSON({
		method: "get",
		url: 'getsearchresults.html?query='+query,
		onSuccess: function(responseJSON, responseText){
			alert(responseText);
		}
	});
	myRequest.send();
}

//Hold the JSON object with current song
var currentSongPlaying = null;

window.addEvent('domready', function() {

	//Init the song manager
	currentSongManager = new SongManager({
		getCurrentSongUrl: 'getcurrent.html',
		onUpdate: function(responseJSON){
			//Back it up
			currentSongPlaying = responseJSON;

			//Update the html
			$('currentAlbum').set('html', "Album: " + responseJSON.album);
			$('currentArtist').set('html', "Artist: " + responseJSON.artist);
			$('currentTitle').set('html', "Title: " + responseJSON.title);
			$('currentInfo').set(
				'html',
				"Info: " + responseJSON.bitrate + "kbps, " +
				responseJSON.samplerate + "kHz " +
				responseJSON.channels
			);
			$('currentAlbumArt').setProperty('src', responseJSON.albumart);
		},
	});

	//When user clicks this link, get the current song played
	$('getCurrent').addEvent('click', function(){
		// If we do addEvent('click',currentSongmanager.update), then 'this' gets set as 'window'
		currentSongManager.update();
	});

	//When the play controls are clicked, get the html page and update the current song
	$('playControls').getElements('a').each(function(el){
		el.addEvent('click', function(event){
			event.preventDefault();
			currentSongManager.update(el.get('href'));
		});
	});

	//Init the searcher
	searcher = new MusicSearcher({
		//The url for the searches
		getSearchResultsUrl: 'getsearchresults.html?query=',

		//When the request is complete
		onSearchComplete: function(responseJSON){
			//Empty the loading...
			$('searchList').empty();

			//For echt song in the JSON response
			responseJSON.each(function(song){
				new Element('a',{
					'href': 'javascript:void(0)',
					'html': song.title,
					'events':{
						'click': function(){
							//If it has two li items, dont create them plx
							if(this.getElements('li').length==2)
								return;

							//Create the 'Play' link
							new Element('a',{
								'href': '#current',
								'html': 'Play',
								'events':{
									'click': function(){
										currentSongManager.update('?file='+song.filename);
									}
								}
							}).inject(
								new Element('li').inject(this) //this refers to 'ul > li > a'
							);

							//Create the 'Enqueue' link
							new Element('a',{
								'href': 'javascript:void(0)',
								'html': 'Enqueue',
								'events':{
									'click': function(e){
										e.stopPropagation();
										currentSongManager.update('?add='+song.filename+'&playaddedifnotplaying');
										this.getParent().getParent().getElements('li').dispose();
									}
								}
							}).inject(
								new Element('li').inject(this) //this refers to 'ul > li > a'
							);
						}
					}
				})
				.inject(new Element('li').inject('searchList')); //Inject the list item to the ul
			});
		}
	});

	//Add listener for album searching
	$('currentAlbum').addEvent('click',function(){
		searcher.search('ALBUM HAS "'+currentSongPlaying.album+'"');
	});
});
</script>
</head>

<body>
    <h1 id="pageTitle"></h1>
    <a id="homeButton" class="button" href="#home">Home</a>
    <a class="button" href="#searchForm">Search</a>

    <ul id="home" title="Home" selected="true">
        <li><a id="getCurrent" href="#current">Current Played File</a></li>
        <li><a href="#test">Enqueue</a></li>
        <li><a href="#options">Options</a></li>
        <li><a href="#player">Jasdfdf</a></li>
        <li><a href="asdf">Normal link</a></li>
    </ul>

    <div id="current" class="panel" title="Current">
    	<table id="playControls" width="100%">
			<tr>
				<td>
					<a href="?prev">
						<img src="images/prev.gif" width="24" height="24" border="0" alt="jump to previous song">
					</a>
				</td>
				<td>
					<a href="?play">
						<img src="images/play.gif" width="24" height="24" border="0" alt="start playback">
					</a>
				</td>
				<td>
					<a href="?stop">
						<img src="images/stop.gif" width="24" height="24" border="0" alt="stop playback">
					</a>
				</td>
				<td>
					<a href="?pause">
						<img src="images/pause.gif" width="24" height="24" border="0" alt="pause playback">
					</a>
				</td>
				<td>
					<a href="?next">
						<img src="images/next.gif" width="24" height="24" border="0" alt="jump to next song">
					</a>
				</td>
			</tr>
		</table>

        <ul>
			<li><a href="#searchResults" id="currentAlbum">Album: <img src="images/loading.gif" width="20" /></a></li>
			<li id="currentArtist">Artist: <img src="images/loading.gif" width="20" /></li>
			<li id="currentTitle">Title: <img src="images/loading.gif" width="20" /></li>
			<li id="currentInfo">Info: <img src="images/loading.gif" width="20" /></li>
		</ul>
		<img id="currentAlbumArt" src="images/loading.gif" width="100" />
    </div>

    <div id="test" class="panel" title="Belle & Sebastian">
		<h2>Normal list</h2>
		<ul>
			<li>About</li>
			<li>Blog</li>
		</ul>
		<h2>Link List:</h2>
		<ul>
			<li><a href="#consulting-clinic.html">Consulting Clinic</a></li>
			<li><a href="#on-call.html">On Call</a></li>
			<li><a href="#development.html">Development</a></li>
		</ul>
		<h2>About</h2>
		<p>Jonathan Stark is a web developer, speaker, and author. His
		   consulting firm, Jonathan Stark Consulting, Inc., has attracted
		   clients such as Staples, Turner Broadcasting, and the PGA Tour.
		   ...
		</p>
		<p>Jonathan Stark is a mobile and web application developer who the
		   Wall Street Journal has called an expert on publishing desktop
		   data to the web.</p>
		<ul>
			<li><a href="#services.html">Services</a></li>
			<li><a href="#about.html">About</a></li>
			<li><a href="#blog.html">Blog</a></li>
		</ul>
    </div>

    <div id="options" class="panel" title="Options">
        <ul>
			<li>dsfg</li>
			<li>sdfars</li>
			<li>ds ase rtg fg</li>
			<li>araw</li>
		</ul>
	</div>

    <ul id="CrowdedHouse" title="Crowded House">
        <li><a href="#songs">Crowded House</a></li>
        <li><a href="#songs">Temple of Low Men</a></li>
        <li><a href="#songs">Together Alone</a></li>
        <li><a href="#songs">Woodface</a></li>
    </ul>
    <ul id="JohnMayer" title="John Mayer">
        <li><a href="#songs">Continuum</a></li>
        <li><a href="#songs">Heavier Things</a></li>
        <li><a href="#songs">Room for Squares</a></li>
    </ul>
    <ul id="Zero7" title="Zero 7">
        <li><a href="#songs">The Garden</a></li>
        <li><a href="#songs">Simple Things</a></li>
        <li><a href="#songs">When it Falls</a></li>
    </ul>
    <ul id="songs" title="Songs">
        <li><a href="#player">Song 1</a></li>
        <li><a href="#player">Song 2</a></li>
        <li><a href="#player">Song 3</a></li>
        <li><a href="#player">Song 4</a></li>
        <li><a href="#player">Song 5</a></li>
        <li><a href="#player">Song 6</a></li>
        <li><a href="#player">Song 7</a></li>
        <li><a href="#player">Song 8</a></li>
        <li><a href="#player">Song 9</a></li>
        <li><a href="#player">Song 10</a></li>
        <li><a href="#player">Song 11</a></li>
    </ul>
    <div id="player" class="panel" title="Now Playing">
        <p>asdf</p>
    </div>
    <div id="searchResults" class="panel" title="Search" onfocus="getSearchResults(this)">
		<h2>Search Results</h2>
		<ul id="searchList">
			<li><img src="images/loading.gif" width="24"></li>
		</ul>
    </div>
    <form id="searchForm" class="dialog" action="#searchResults">
        <fieldset>
            <h1>Music Search</h1>
            <a class="button toolButton goButton" href="#searchResults">Search</a>

            <label>Artist:</label>
            <input type="text" name="artist" />
            <label>Song:</label>
            <input type="text" name="song" />
        </fieldset>
    </form>
</body>
</html>
